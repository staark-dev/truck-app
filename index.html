<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Support Pro - Suedia</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3498db">
    <meta name="description" content="Aplica»õie pentru managementul timpilor de lucru conform reglementƒÉrilor din Suedia">
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./styles.css">
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">
    <!-- Prevent zoom on input focus -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body class="no-select">
    <!-- Install Banner -->
    <div class="install-banner" id="installBanner">
        <div class="install-text">üì± InstaleazƒÉ aplica»õia pentru acces rapid!</div>
        <button class="install-btn" id="installBtn">InstaleazƒÉ</button>
        <button class="install-close" onclick="hideInstallBanner()">√ó</button>
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <button class="voice-control" onclick="toggleVoiceControl()" id="voiceBtn" title="Control vocal">
                üé§
            </button>
            <div class="driver-info">
                <div class="driver-name" id="driverName">Alexandru Popescu</div>
                <div class="truck-number" id="truckNumber">Camion #SE-4521</div>
                <div class="status-indicators">
                    <div class="status-badge" id="gpsStatus">
                        <span class="status-dot status-gps"></span>
                        GPS Activ
                    </div>
                    <div class="status-badge" id="networkStatus">
                        <span class="status-dot status-offline"></span>
                        Offline Ready
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Panel -->
        <div class="alert-panel" id="alertPanel" onclick="hideAlert()">
            <div class="alert-title">‚ö†Ô∏è AlertƒÉ Siguran»õƒÉ</div>
            <div class="alert-message" id="alertMessage">Pauza obligatorie √Æn 15 minute!</div>
        </div>

        <div class="content">
            <!-- Page: Program -->
            <div class="page active" id="pageProgram">
                <div class="controls">
                    <!-- Status Card -->
                    <div class="status-card" id="statusCard">
                        <div class="status-item">
                            <span class="status-label">Stare:</span>
                            <span class="status-value" id="currentState">Program inactiv</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Program √Ænceput la:</span>
                            <span class="status-value" id="programStartTime">-</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Activitate curentƒÉ:</span>
                            <span class="status-value" id="currentActivity">Nicio activitate</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Timp activitate:</span>
                            <span class="status-value" id="activityTime">00:00:00</span>
                        </div>
                    </div>

                    <!-- Start Program Button -->
                    <div class="control-grid" id="startButton">
                        <button class="control-btn btn-start" onclick="startProgram()">
                            Start Program
                        </button>
                    </div>

                    <!-- Control Buttons -->
                    <div class="control-buttons" id="controlButtons">
                        <div class="control-grid">
                            <button class="control-btn" id="btnDriving" onclick="setActivity('driving', 'Condus', this)">
                                Condus
                            </button>
                            
                            <button class="control-btn" id="btnBreak" onclick="setActivity('break', 'PauzƒÉ', this)">
                                PauzƒÉ
                            </button>
                            
                            <button class="control-btn" id="btnWork" onclick="setActivity('work', 'MuncƒÉ', this)">
                                MuncƒÉ
                            </button>
                            
                            <button class="control-btn" id="btnOther" onclick="setActivity('other', 'Alte activitƒÉ»õi', this)">
                                Alte activitƒÉ»õi
                            </button>
                            
                            <button class="control-btn btn-end" onclick="endProgram()">
                                TerminƒÉ Program
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Progress Overview -->
                <div class="card">
                    <h3 class="card-title">Status Zilnic</h3>
                    <div class="progress-ring-container">
                        <div class="progress-ring">
                            <div class="progress-circle" id="drivingProgress">
                                <div class="progress-inner">
                                    <span id="drivingPercentage">0%</span>
                                    <span style="font-size: 10px;">Condus</span>
                                </div>
                            </div>
                        </div>
                        <div class="progress-ring">
                            <div class="progress-circle" id="breakProgress">
                                <div class="progress-inner">
                                    <span id="breakPercentage">0%</span>
                                    <span style="font-size: 10px;">Pauze</span>
                                </div>
                            </div>
                        </div>
                        <div class="progress-ring">
                            <div class="progress-circle" id="workProgress">
                                <div class="progress-inner">
                                    <span id="workPercentage">0%</span>
                                    <span style="font-size: 10px;">Alte</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <div style="font-size: 14px; color: #7f8c8d;">Timp total program</div>
                        <div style="font-size: 20px; font-weight: bold;" id="totalProgramTime">00:00:00</div>
                    </div>
                </div>

                <div class="location-card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; font-size: 18px;">üìç Loca»õia CurentƒÉ</h3>
                        <button onclick="refreshLocation()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer;">
                            üîÑ
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;" id="currentLocation">
                            Se ob»õine loca»õia...
                        </div>
                        <div style="font-size: 12px; opacity: 0.9;">
                            Ultimul update: <span id="locationLastUpdate">--:--</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 12px; opacity: 0.8;">VitezƒÉ curentƒÉ</div>
                            <div style="font-size: 18px; font-weight: bold;" id="currentSpeed">0 km/h</div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="shareCurrentLocation()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                üì§ Trimite
                            </button>
                            <button onclick="openLocationInMaps()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                üó∫Ô∏è Maps
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Card-ul meteo poate rƒÉm√¢ne la fel, acum va fi actualizat automat cu loca»õia realƒÉ -->
                <div class="weather-card" style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #2c3e50;" id="weatherTemp">--¬∞C</div>
                            <div style="font-size: 14px; color: #7f8c8d;" id="weatherDesc">Se √ÆncarcƒÉ...</div>
                        </div>
                        <div style="font-size: 36px;">üå§Ô∏è</div>
                    </div>
                </div>
            </div>

            <!-- Additional pages will be loaded dynamically -->
            <div class="page" id="pageGPS">
                <div class="page-content">
                    <h2 class="page-title">GPS & Localizare</h2>
                    <div class="card">
                        <div id="gpsContent">
                            <div style="text-align: center; padding: 40px 20px;">
                                <div class="loading" style="width: 40px; height: 40px; border-width: 4px;"></div>
                                <div style="margin-top: 15px;">√éncƒÉrcare paginƒÉ GPS...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="pageSettings">
                <div class="page-content">
                    <h2 class="page-title">SetƒÉri</h2>
                    
                    <!-- Driver Info -->
                    <div class="card">
                        <h3 class="card-title">Informa»õii »òofer</h3>
                        <div class="setting-item">
                            <label class="setting-label">Numele »ôoferului:</label>
                            <input type="text" class="setting-input" id="settingDriverName" value="Alexandru Popescu" />
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">NumƒÉrul camionului:</label>
                            <input type="text" class="setting-input" id="settingTruckNumber" value="SE-4521" />
                        </div>
                    </div>

                    <!-- App Settings -->
                    <div class="card">
                        <h3 class="card-title">SetƒÉri Aplica»õie</h3>
                        <div class="setting-item">
                            <label class="setting-label">Mod √Æntunecat:</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()" />
                                <label for="darkModeToggle" class="toggle-label"></label>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">Control vocal:</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="voiceControlToggle" checked />
                                <label for="voiceControlToggle" class="toggle-label"></label>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">Alerte sonore:</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="soundAlertsToggle" />
                                <label for="soundAlertsToggle" class="toggle-label"></label>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div style="margin-top: 20px;">
                        <button class="control-btn" onclick="saveSettings()" style="background: #27ae60; color: white; border-color: #27ae60; width: 100%;">
                            üíæ SalveazƒÉ SetƒÉri
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-grid">
                <button class="nav-item active" onclick="switchTab(this, 'program')">
                    <div class="nav-icon">üöõ</div>
                    <div class="nav-label">Program</div>
                </button>
                
                <button class="nav-item" onclick="switchTab(this, 'gps')">
                    <div class="nav-icon">üìç</div>
                    <div class="nav-label">GPS</div>
                </button>
                
                <button class="nav-item" onclick="switchTab(this, 'fuel')">
                    <div class="nav-icon">‚õΩ</div>
                    <div class="nav-label">Fuel</div>
                </button>
                
                <button class="nav-item" onclick="switchTab(this, 'reports')">
                    <div class="nav-icon">üìä</div>
                    <div class="nav-label">Rapoarte</div>
                </button>
                
                <button class="nav-item" onclick="switchTab(this, 'settings')">
                    <div class="nav-icon">‚öôÔ∏è</div>
                    <div class="nav-label">SetƒÉri</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #2c3e50; color: white; padding: 12px 20px; border-radius: 25px; z-index: 1000; opacity: 0; transition: all 0.3s ease; font-weight: 500;"></div>

<!-- Core classes -->
<script src="js/data-manager.js"></script>
<script src="js/time-tracker.js"></script>
<script src="js/location-service.js"></script>
<script src="js/alerts.js"></script>

<!-- Op»õional: expune clasele pe window (ajutƒÉ »ôi alte pagini) -->
<script>
  window.DataManager     = window.DataManager     || (typeof DataManager     !== 'undefined' ? DataManager     : undefined);
  window.TimeTracker     = window.TimeTracker     || (typeof TimeTracker     !== 'undefined' ? TimeTracker     : undefined);
  window.LocationService = window.LocationService || (typeof LocationService !== 'undefined' ? LocationService : undefined);
  window.AlertSystem     = window.AlertSystem     || (typeof AlertSystem     !== 'undefined' ? AlertSystem     : undefined);
</script>

<!-- App dupƒÉ clase -->
<script src="js/app.js"></script>
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // PWA Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallBanner();
        });

        function showInstallBanner() {
            document.getElementById('installBanner').classList.add('show');
        }

        function hideInstallBanner() {
            document.getElementById('installBanner').classList.remove('show');
        }

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    hideInstallBanner();
                }
                deferredPrompt = null;
            }
        });

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
    
<script>
(function(){
  const box = document.createElement('pre');
  box.id = 'debugOverlay';
  box.style.cssText = 'position:fixed;left:0;right:0;bottom:0;max-height:40vh;overflow:auto;margin:0;background:#111;color:#0f0;padding:8px;font:12px/1.4 monospace;z-index:99999;opacity:.95;display:none';
  document.body.appendChild(box);
  const show = (msg)=>{ box.style.display='block'; box.textContent += msg + '\n'; };

  // Catch runtime errors
  window.addEventListener('error', e => show('‚ùå ' + (e.error?.stack || e.message)));

  // Catch unhandled promise rejections
  window.addEventListener('unhandledrejection', e => show('‚ö†Ô∏è Promise: ' + (e.reason?.stack || e.reason)));

  // Simple console mirror for quick checks (toggle by long-press)
  let pressTimer;
  window.addEventListener('touchstart', ()=> pressTimer = setTimeout(()=> box.style.display = (box.style.display==='none'?'block':'none'), 700));
  window.addEventListener('touchend', ()=> clearTimeout(pressTimer));
  console.log = ((orig)=>function(){ show('üìù ' + Array.from(arguments).map(a=> typeof a==='object'?JSON.stringify(a):String(a)).join(' ')); orig.apply(console, arguments); })(console.log);
})();
</script>
    
</body>
</html>
